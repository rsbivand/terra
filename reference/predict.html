<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Make a SpatRaster object with predictions from a fitted model object (for example, obtained with glm or randomForest). The first argument is a SpatRaster object with the predictor variables. The names in the Raster object should exactly match those expected by the model. Any regression like model for which a predict method has been implemented (or can be implemented) can be used.
The method should work if the model's predict function returns a vector, matrix or data.frame (or a list that can be coerced to a data.frame). In other cases it may be necessary to provide a custom &quot;predict&quot; function that wraps the model's predict function to return the values in the required form. See the examples.
This approach of using model predictions is commonly used in remote sensing (for the classification of satellite images) and in ecology, for species distribution modeling."><title>Spatial model predictions — predict • terra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial model predictions — predict"><meta property="og:description" content="Make a SpatRaster object with predictions from a fitted model object (for example, obtained with glm or randomForest). The first argument is a SpatRaster object with the predictor variables. The names in the Raster object should exactly match those expected by the model. Any regression like model for which a predict method has been implemented (or can be implemented) can be used.
The method should work if the model's predict function returns a vector, matrix or data.frame (or a list that can be coerced to a data.frame). In other cases it may be necessary to provide a custom &quot;predict&quot; function that wraps the model's predict function to return the values in the required form. See the examples.
This approach of using model predictions is commonly used in remote sensing (for the classification of satellite images) and in ecology, for species distribution modeling."><meta property="og:image" content="https://rspatial.github.io/terra/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">terra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7-58</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../reference/terra-package.html">Description</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://rspatial.org">Tutorials</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rspatial/terra/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spatial model predictions</h1>
      
      <div class="d-none name"><code>predict.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Make a SpatRaster object with predictions from a fitted model object (for example, obtained with <code>glm</code> or <code>randomForest</code>). The first argument is a SpatRaster object with the predictor variables. The <code><a href="names.html">names</a></code> in the Raster object should exactly match those expected by the model. Any regression like model for which a predict method has been implemented (or can be implemented) can be used.</p>
<p>The method should work if the model's predict function returns a vector, matrix or data.frame (or a list that can be coerced to a data.frame). In other cases it may be necessary to provide a custom "predict" function that wraps the model's predict function to return the values in the required form. See the examples.</p>
<p>This approach of using model predictions is commonly used in remote sensing (for the classification of satellite images) and in ecology, for species distribution modeling.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for SpatRaster</span></span>
<span><span class="fu">predict</span><span class="op">(</span><span class="va">object</span>, <span class="va">model</span>, fun<span class="op">=</span><span class="va">predict</span>, <span class="va">...</span>, const<span class="op">=</span><span class="cn">NULL</span>, na.rm<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>          index<span class="op">=</span><span class="cn">NULL</span>, cores<span class="op">=</span><span class="fl">1</span>, cpkgs<span class="op">=</span><span class="cn">NULL</span>, filename<span class="op">=</span><span class="st">""</span>, overwrite<span class="op">=</span><span class="cn">FALSE</span>, wopt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>SpatRaster</p></dd>

  <dt>model</dt>
<dd><p>fitted model of any class that has a "predict" method (or for which you can supply a similar method as <code>fun</code> argument. E.g. glm, gam, or randomForest</p></dd>

  <dt>fun</dt>
<dd><p>function. The predict function that takes <code>model</code> as first argument. The default value is <code>predict</code>, but can be replaced with e.g. predict.se (depending on the type of model), or your own custom function</p></dd>

  <dt>...</dt>
<dd><p>additional arguments for <code>fun</code></p></dd>
    

  <dt>const</dt>
<dd><p>data.frame. Can be used to add a constant value as a predictor variable so that you do not need to make a SpatRaster layer for it</p></dd>

  <dt>na.rm</dt>
<dd><p>logical. If <code>TRUE</code>, cells with <code>NA</code> values in the any of the layers of <code>x</code> are removed from the computation (even if the <code>NA</code> cell is in a layer that is not used as a variable in the model). This option prevents errors with models that cannot handle <code>NA</code> values when makeing predictions. In most other cases this will not affect the output. However, there are some models that return predicted values even if some (or all) variables are <code>NA</code></p></dd>

  <dt>index</dt>
<dd><p>integer or character. Can be used to to select a subset of the model output variables</p></dd>

  <dt>cores</dt>
<dd><p>positive integer. If <code>cores &gt; 1</code>, a 'parallel' package cluster with that many cores is created and used</p></dd>

  <dt>cpkgs</dt>
<dd><p>character. The package(s) that need to be loaded on the nodes to be able to run the model.predict function (see examples)</p></dd>

  <dt>filename</dt>
<dd><p>character. Output filename</p></dd>

  <dt>overwrite</dt>
<dd><p>logical. If <code>TRUE</code>, <code>filename</code> is overwritten</p></dd>

  <dt>wopt</dt>
<dd><p>list with named options for writing files as in <code><a href="writeRaster.html">writeRaster</a></code></p></dd>

 </dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>SpatRaster</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="interpolate.html">interpolate</a></code> for spatial model prediction</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">logo</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/logo.tif"</span>, package<span class="op">=</span><span class="st">"terra"</span><span class="op">)</span><span class="op">)</span>   </span></span>
<span class="r-in"><span><span class="fu"><a href="names.html">names</a></span><span class="op">(</span><span class="va">logo</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="fl">48</span>, <span class="fl">48</span>, <span class="fl">48</span>, <span class="fl">53</span>, <span class="fl">50</span>, <span class="fl">46</span>, <span class="fl">54</span>, <span class="fl">70</span>, <span class="fl">84</span>, <span class="fl">85</span>, <span class="fl">74</span>, <span class="fl">84</span>, <span class="fl">95</span>, <span class="fl">85</span>, </span></span>
<span class="r-in"><span>   <span class="fl">66</span>, <span class="fl">42</span>, <span class="fl">26</span>, <span class="fl">4</span>, <span class="fl">19</span>, <span class="fl">17</span>, <span class="fl">7</span>, <span class="fl">14</span>, <span class="fl">26</span>, <span class="fl">29</span>, <span class="fl">39</span>, <span class="fl">45</span>, <span class="fl">51</span>, <span class="fl">56</span>, <span class="fl">46</span>, <span class="fl">38</span>, <span class="fl">31</span>, </span></span>
<span class="r-in"><span>   <span class="fl">22</span>, <span class="fl">34</span>, <span class="fl">60</span>, <span class="fl">70</span>, <span class="fl">73</span>, <span class="fl">63</span>, <span class="fl">46</span>, <span class="fl">43</span>, <span class="fl">28</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">33</span>, <span class="fl">64</span>, <span class="fl">85</span>, <span class="fl">92</span>, <span class="fl">94</span>, <span class="fl">59</span>, <span class="fl">27</span>, <span class="fl">30</span>, <span class="fl">64</span>, <span class="fl">60</span>, <span class="fl">33</span>, <span class="fl">31</span>, <span class="fl">9</span>,</span></span>
<span class="r-in"><span>   <span class="fl">99</span>, <span class="fl">67</span>, <span class="fl">15</span>, <span class="fl">5</span>, <span class="fl">4</span>, <span class="fl">30</span>, <span class="fl">8</span>, <span class="fl">37</span>, <span class="fl">42</span>, <span class="fl">27</span>, <span class="fl">19</span>, <span class="fl">69</span>, <span class="fl">60</span>, <span class="fl">73</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">21</span>,</span></span>
<span class="r-in"><span>   <span class="fl">37</span>, <span class="fl">52</span>, <span class="fl">70</span>, <span class="fl">74</span>, <span class="fl">9</span>, <span class="fl">13</span>, <span class="fl">4</span>, <span class="fl">17</span>, <span class="fl">47</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">p</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># extract predictor values for points</span></span></span>
<span class="r-in"><span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="extract.html">extract</a></span><span class="op">(</span><span class="va">logo</span>, <span class="va">xy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># combine with response (excluding the ID column)</span></span></span>
<span class="r-in"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>pa<span class="op">=</span><span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">e</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#build a model, here with glm </span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#predict to a raster</span></span></span>
<span class="r-in"><span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="lines.html">points</a></span><span class="op">(</span><span class="va">p</span>, bg<span class="op">=</span><span class="st">'blue'</span>, pch<span class="op">=</span><span class="fl">21</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="lines.html">points</a></span><span class="op">(</span><span class="va">a</span>, bg<span class="op">=</span><span class="st">'red'</span>, pch<span class="op">=</span><span class="fl">21</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># logistic regression</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-in"><span><span class="va">r1log</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to get the probability and standard error</span></span></span>
<span class="r-in"><span><span class="va">r1se</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span>, se.fit<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or provide a custom predict function</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">predfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span>, se.fit<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>p<span class="op">=</span><span class="fu"><a href="coerce.html">as.vector</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span>, se<span class="op">=</span><span class="fu"><a href="coerce.html">as.vector</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">se.fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span>, fun<span class="op">=</span><span class="va">predfun</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### principal components of a SpatRaster</span></span></span>
<span class="r-in"><span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">logo</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or use sampling if you have a large raster </span></span></span>
<span class="r-in"><span><span class="co"># and cannot process all cell values</span></span></span>
<span class="r-in"><span><span class="va">sr</span> <span class="op">&lt;-</span> <span class="fu"><a href="sample.html">spatSample</a></span><span class="op">(</span><span class="va">logo</span>, <span class="fl">100000</span>, <span class="st">"regular"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">sr</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">pca</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="predict-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## parallelization</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## simple case with GLM </span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">model</span>, cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The above does not work with a model from a contributed</span></span></span>
<span class="r-in"><span><span class="co">## package, as the package needs to be loaded in each core. </span></span></span>
<span class="r-in"><span><span class="co">## Below are three approaches to deal with that </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rfm</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## approach 0 (not parallel) </span></span></span>
<span class="r-in"><span><span class="va">rp0</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## approach 1, use the "cpkgs" argument </span></span></span>
<span class="r-in"><span><span class="va">rp1</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm</span>, cores<span class="op">=</span><span class="fl">2</span>, cpkgs<span class="op">=</span><span class="st">"randomForest"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## approach 2, write a custom predict function that loads the package</span></span></span>
<span class="r-in"><span><span class="va">rfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">predict</span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">rp2</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm</span>, fun<span class="op">=</span><span class="va">rfun</span>, cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## approach 3, write a parallelized custom predict function </span></span></span>
<span class="r-in"><span><span class="va">rfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">ncls</span> <span class="op">&lt;-</span> <span class="fu"><a href="dimensions.html">length</a></span><span class="op">(</span><span class="va">cls</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">nr</span> <span class="op">&lt;-</span> <span class="fu"><a href="dimensions.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="split.html">split</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ncls</span>, each<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">nr</span><span class="op">/</span><span class="va">ncls</span><span class="op">)</span>, length.out<span class="op">=</span><span class="va">nr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span>  <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterApply</a></span><span class="op">(</span><span class="va">cls</span>, <span class="va">s</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu">predict</span><span class="op">(</span><span class="va">mod</span>, <span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cls</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span><span class="va">cls</span>, <span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="st">"rfm"</span>, <span class="st">"rfun"</span>, <span class="st">"randomForest"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rp3</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm</span>, fun<span class="op">=</span><span class="va">rfun</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cls</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="va">rp0</span>, <span class="va">rp1</span>, <span class="va">rp2</span>, <span class="va">rp3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### with two output variables (probabilities for each class)</span></span></span>
<span class="r-in"><span><span class="va">v</span><span class="op">$</span><span class="va">pa</span> <span class="op">&lt;-</span> <span class="fu"><a href="is.bool.html">as.factor</a></span><span class="op">(</span><span class="va">v</span><span class="op">$</span><span class="va">pa</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rfm2</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span>formula<span class="op">=</span><span class="va">pa</span><span class="op">~</span><span class="va">.</span>, data<span class="op">=</span><span class="va">v</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rfp</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">logo</span>, <span class="va">rfm2</span>, cores<span class="op">=</span><span class="fl">2</span>, type<span class="op">=</span><span class="st">"prob"</span>, cpkgs<span class="op">=</span><span class="st">"randomForest"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

