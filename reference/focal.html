<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='Calculate focal ("moving window") values for each cell.'><title>Focal values — focal • terra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Focal values — focal"><meta property="og:description" content='Calculate focal ("moving window") values for each cell.'><meta property="og:image" content="https://rspatial.github.io/terra/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">terra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7-67</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../reference/terra-package.html">Description</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://rspatial.org">Tutorials</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rspatial/terra/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Focal values</h1>
      
      <div class="d-none name"><code>focal.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate focal ("moving window") values for each cell.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for SpatRaster</span></span>
<span><span class="fu">focal</span><span class="op">(</span><span class="va">x</span>, w<span class="op">=</span><span class="fl">3</span>, fun<span class="op">=</span><span class="st">"sum"</span>, <span class="va">...</span>, na.policy<span class="op">=</span><span class="st">"all"</span>, fillvalue<span class="op">=</span><span class="cn">NA</span>, </span>
<span>    expand<span class="op">=</span><span class="cn">FALSE</span>, silent<span class="op">=</span><span class="cn">TRUE</span>, filename<span class="op">=</span><span class="st">""</span>, overwrite<span class="op">=</span><span class="cn">FALSE</span>, wopt<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>SpatRaster</p></dd>

  
<dt>w</dt>
<dd><p>window. The window can be defined as one (for a square) or two numbers (row, col); or with an odd-sized weights matrix. See Details.</p></dd>


<dt>fun</dt>
<dd><p>function that takes multiple numbers, and returns a numeric vector (one or multiple numbers). For example mean, modal, min or max</p></dd>


<dt>...</dt>
<dd><p>additional arguments passed to <code>fun</code> such as <code>na.rm</code></p></dd>


<dt>na.policy</dt>
<dd><p>character. Can be used to determine the cells of <code>x</code> for which focal values should be computed. Must be one of "all" (compute for all cells), "only" (only for cells that are <code>NA</code>) or "omit" (skip cells that are <code>NA</code>). Note that the value of this argument does not affect which cells around each focal cell are included in the computations (use <code>na.rm=TRUE</code> to ignore cells that are <code>NA</code> for that)</p></dd>


<dt>fillvalue</dt>
<dd><p>numeric. The value of the cells in the virtual rows and columns outside of the raster</p></dd>


<dt>expand</dt>
<dd><p>logical. If <code>TRUE</code> The value of the cells in the virtual rows and columns outside of the raster are set to be the same as the value on the border. Only available for "build-in" <code>fun</code>s such as mean, sum, min and max</p></dd>


<dt>silent</dt>
<dd><p>logical. If <code>TRUE</code> error messages are printed that may occur when trying <code>fun</code> to determine the length of the returned value. This can be useful in debugging a <code>fun</code> that does not work</p></dd>


<dt>filename</dt>
<dd><p>character. Output filename</p></dd>

<dt>overwrite</dt>
<dd><p>logical. If <code>TRUE</code>, <code>filename</code> is overwritten</p></dd>


<dt>wopt</dt>
<dd><p>additional arguments for writing files as in <code><a href="writeRaster.html">writeRaster</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>focal</code> 
The window used must have odd dimensions. If you need even sides, you can use a matrix and add a column or row of <code>NA</code>'s to mask out values.</p>
<p>Window values are typically 1 or <code>NA</code> to indicate whether a value is used or ignored in computations, respectively. <code>NA</code> values in <code>w</code> can be useful for creating non-rectangular (e.g. circular) windows.</p>
<p>A weights matrix of numeric values can also be supplied to <code>w</code>. In the case of a weights matrix, cells with <code>NA</code> weights will be ignored, and the rest of the values in the focal window will be multiplied by the corresponding weight prior to `fun` being applied. Note, <code>na.rm</code> does not need to be <code>TRUE</code> if <code>w</code> contains <code>NA</code> values as these cells are ignored in computations.</p>
<p>The "mean" function is a special case, where supplying weights to <code>w</code> will instead calculate a weighted mean.</p>
<p>The "sum" function returns <code>NA</code> if all focal cells are <code>NA</code> and <code>na.rm=TRUE</code>. R would normally return a zero in these cases. See the difference between <code>focal(x, fun=sum, na.rm=TRUE)</code> and <code>focal(x, fun=\(i) sum(i, na.rm=TRUE))</code></p>

<p>Example weight matrices</p>
<p>Laplacian filter: <code>filter=matrix(c(0,1,0,1,-4,1,0,1,0), nrow=3)</code></p>
<p>Sobel filters (for edge detection):</p>
<p><code>fx=matrix(c(-1,-2,-1,0,0,0,1,2,1), nrow=3)</code></p>
<p><code>fy=matrix(c(1,0,-1,2,0,-2,1,0,-1), nrow=3)</code></p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>When using global lon/lat rasters, the focal window "wraps around" the date-line.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>SpatRaster</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="focalMat.html">focalMat</a></code>, <code><a href="focalValues.html">focalValues</a></code>, <code><a href="focal3D.html">focal3D</a></code>, <code><a href="focalPairs.html">focalPairs</a></code>, <code><a href="focalReg.html">focalReg</a></code>, <code><a href="focalCpp.html">focalCpp</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span>ncols<span class="op">=</span><span class="fl">10</span>, nrows<span class="op">=</span><span class="fl">10</span>, <span class="fu"><a href="ext.html">ext</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="values.html">values</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="dimensions.html">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, w<span class="op">=</span><span class="fl">3</span>, fun<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="c.html">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.5</span>, <span class="fl">.75</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, w<span class="op">=</span><span class="fl">3</span>, fun<span class="op">=</span><span class="st">"mean"</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the following two statements are equivalent:</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, w<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">9</span>, nc<span class="op">=</span><span class="fl">3</span>, nr<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, w<span class="op">=</span><span class="fl">3</span>, fun<span class="op">=</span><span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># but this is different</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, w<span class="op">=</span><span class="fl">3</span>, fun<span class="op">=</span><span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## illustrating the effect of different </span></span></span>
<span class="r-in"><span><span class="co">## combinations of na.rm and na.policy</span></span></span>
<span class="r-in"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="vect.html">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/lux.shp"</span>, package<span class="op">=</span><span class="st">"terra"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/elev.tif"</span>, package<span class="op">=</span><span class="st">"terra"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span><span class="op">[</span><span class="fl">45</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">45</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># also try "mean" or "min"</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="st">"sum"</span> </span></span>
<span class="r-in"><span><span class="co"># na.rm=FALSE</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, <span class="fl">5</span>, <span class="va">f</span><span class="op">)</span> , fun<span class="op">=</span><span class="fu"><a href="lines.html">lines</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="focal-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># na.rm=TRUE</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, <span class="fl">5</span>, <span class="va">f</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, fun<span class="op">=</span><span class="fu"><a href="lines.html">lines</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="focal-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># only change cells that are NA</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, <span class="fl">5</span>, <span class="va">f</span>, na.policy<span class="op">=</span><span class="st">"only"</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, fun<span class="op">=</span><span class="fu"><a href="lines.html">lines</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="focal-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># do not change cells that are NA</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.html">plot</a></span><span class="op">(</span><span class="fu">focal</span><span class="op">(</span><span class="va">r</span>, <span class="fl">5</span>, <span class="va">f</span>, na.policy<span class="op">=</span><span class="st">"omit"</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, fun<span class="op">=</span><span class="fu"><a href="lines.html">lines</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="focal-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># does not do anything</span></span></span>
<span class="r-in"><span><span class="co"># focal(r, 5, f, na.policy="only", na.rm=FALSE)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

