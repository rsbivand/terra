<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Compute correlation, (weighted) covariance, or similar summary statistics that compare the values of all pairs of the layers of a SpatRaster."><title>Correlation and (weighted) covariance — layerCor • terra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Correlation and (weighted) covariance — layerCor"><meta property="og:description" content="Compute correlation, (weighted) covariance, or similar summary statistics that compare the values of all pairs of the layers of a SpatRaster."><meta property="og:image" content="https://rspatial.github.io/terra/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">terra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7-67</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../reference/terra-package.html">Description</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://rspatial.org">Tutorials</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rspatial/terra/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Correlation and (weighted) covariance</h1>
      
      <div class="d-none name"><code>layerCor.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute correlation, (weighted) covariance, or similar summary statistics that compare the values of all pairs of the layers of a SpatRaster.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for SpatRaster</span></span>
<span><span class="fu">layerCor</span><span class="op">(</span><span class="va">x</span>, <span class="va">fun</span>, <span class="va">w</span>, asSample<span class="op">=</span><span class="cn">TRUE</span>, use<span class="op">=</span><span class="st">"everything"</span>, maxcell<span class="op">=</span><span class="cn">Inf</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>SpatRaster</p></dd>


  <dt>fun</dt>
<dd><p>character. The statistic to compute: either "cov" (covariance), "weighted.cov" (weighted covariance), or "cor" (pearson correlation coefficient) or your own function that takes two vectors as argument to compute a single number</p></dd>


  <dt>w</dt>
<dd><p>SpatRaster with the weights  to compute the weighted covariance. It should have a single layer and the same geometry as <code>x</code></p></dd>


  <dt>asSample</dt>
<dd><p>logical. If <code>TRUE</code>, the statistic for a sample (denominator is <code>n-1</code>) is computed, rather than for the population (denominator is <code>n</code>). Only for the standard functions</p></dd>

   
  <dt>use</dt>
<dd><p>character. To decide how to handle missing values. This must be (an abbreviation of) one of "everything", "complete.obs", "pairwise.complete.obs", "masked.complete". With "pairwise.complete.obs", the value for a pair of layers is computed for all cells that are not <code>NA</code> in that pair. Therefore, it may be that the (number of) cells used varies between pairs. The benefit of this approach is that all available data is used. Use "complete.obs", if you want to only use the values from cells that are not <code>NA</code> in any of the layers. By using "masked.complete" you indicate that all layers have NA values in the same cells</p></dd>

    
  <dt>maxcell</dt>
<dd><p>positive integer. The maximum number of cells to be used. If this is smaller than ncell(x), a regular sample of <code>x</code> is used</p></dd>


  <dt>...</dt>
<dd><p>additional arguments for <code>fun</code> (if it is a proper function)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>If <code>fun</code> is one of the three standard statistics, you get a list with two items: the correlation or (weighted) covariance matrix, and the (weighted) means. The means are also a matrix because they may depend on the combination of layers if different cells have NAs and are excluded from the computation. The rows of the mean matrix represent the layer whose (weighted) mean is being calculated and the columns represent the layer it is being paired with. Only cells with complete pair observations for both layers are used in the calculation of the (weighted) mean. The diagonal of the mean matrices are assigned NA.</p>


<p>If <code>fun</code> is a function, you get a single matrix.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>For the weighted covariance:</p><ul><li><p>Canty, M.J. and A.A. Nielsen, 2008. Automatic radiometric normalization of multitemporal satellite imagery with the iteratively re-weighted MAD transformation. Remote Sensing of Environment 112:1025-1036.</p></li>
<li><p>Nielsen, A.A., 2007. The regularized iteratively reweighted MAD method for change detection in multi- and hyperspectral data. IEEE Transactions on Image Processing 16(2):463-478.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="global.html">global</a></code>, <code><a href="https://rdrr.io/r/stats/cov.wt.html" class="external-link">cov.wt</a></code>, <code><a href="weighted.mean.html">weighted.mean</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="rast.html">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/logo.tif"</span>, package<span class="op">=</span><span class="st">"terra"</span><span class="op">)</span><span class="op">)</span>   </span></span>
<span class="r-in"><span><span class="fu">layerCor</span><span class="op">(</span><span class="va">b</span>, <span class="st">"pearson"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $correlation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             red     green      blue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> red   1.0000000 0.9980961 0.9501633</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> green 0.9980961 1.0000000 0.9658011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> blue  0.9501633 0.9658011 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            red    green     blue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> red        NaN 182.2855 182.2855</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> green 185.3509      NaN 185.3509</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> blue  192.8046 192.8046      NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        red green blue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> red    NaN  7777 7777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> green 7777   NaN 7777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> blue  7777  7777  NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">layerCor</span><span class="op">(</span><span class="va">b</span>, <span class="st">"cov"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $covariance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            red    green     blue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> red   5564.371 5443.405 4993.165</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> green 5443.405 5345.403 4974.478</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> blue  4993.165 4974.478 4962.942</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            red    green     blue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> red   182.2855 182.2855 182.2855</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> green 185.3509 185.3509 185.3509</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> blue  192.8046 192.8046 192.8046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 7777 7777 7777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 7777 7777 7777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 7777 7777 7777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># weigh by column number</span></span></span>
<span class="r-in"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="init.html">init</a></span><span class="op">(</span><span class="va">b</span>, fun<span class="op">=</span><span class="st">"col"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">layerCor</span><span class="op">(</span><span class="va">b</span>, <span class="st">"weighted.cov"</span>, w<span class="op">=</span><span class="va">w</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $weighted_covariance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            red    green     blue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> red   5670.750 5536.351 5009.851</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> green 5536.351 5427.161 4987.092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> blue  5009.851 4987.092 4937.007</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $weighted_mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            red    green     blue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> red   177.5983 177.5983 177.5983</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> green 181.3521 181.3521 181.3521</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> blue  191.5236 191.5236 191.5236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

